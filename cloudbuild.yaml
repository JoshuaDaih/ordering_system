steps:
# 第一步：使用 Dockerfile 建置 Docker 映像檔
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/order-app:$COMMIT_SHA', '.']

# 第二步：將建置好的映像檔推送到 Google Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/order-app:$COMMIT_SHA']

# 第三步：將映像檔部署到 Google Cloud Run
# 服務名稱設定為 "order-app"
# 部署區域選擇最適合您的位置，例如 "asia-east1" (台灣)
# --allow-unauthenticated 允許未驗證的公開存取，若不希望公開，請移除此行
- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - 'run'
  - 'deploy'
  - 'order-app'
  - '--image=gcr.io/$PROJECT_ID/order-app:$COMMIT_SHA'
  - '--region=asia-east1'
  - '--platform=managed'
  - '--allow-unauthenticated'